import{t as s}from"./styles-DXc76zUi.js";const P="https://api.libiss.com/api/v1",G="libiss-pos-lang",R="ru",U=Array.from(document.querySelectorAll("[data-i18n]")),$=Array.from(document.querySelectorAll("[data-i18n-attr]")),j=Array.from(document.querySelectorAll(".lang-btn")),i=document.querySelector("[data-form]"),h=document.querySelector("[data-status]"),y=document.querySelector("#cityId"),u=Array.from(document.querySelectorAll("[data-step]")),g=document.querySelector("[data-next]"),S=document.querySelector("[data-prev]"),H=new Map(Array.from(document.querySelectorAll("[data-error-for]")).map(e=>[e.dataset.errorFor,e])),c=()=>{const e=localStorage.getItem(G);return e&&s[e]?e:navigator.language.toLowerCase().startsWith("ru")?"ru":"en"},K=e=>{const t=s[e]||s[R];U.forEach(r=>{const o=r.dataset.i18n;t[o]&&(r.textContent=t[o])}),$.forEach(r=>{const o=r.dataset.i18nAttr,n=r.dataset.i18nKey;o&&n&&t[n]&&r.setAttribute(o,t[n])}),document.documentElement.lang=e,j.forEach(r=>{r.classList.toggle("is-active",r.dataset.lang===e)}),localStorage.setItem(G,e)};j.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.lang;t&&(K(t),J())})});const l=(e,t)=>{h&&(h.textContent=e,h.classList.toggle("is-error",t==="error"),h.classList.toggle("is-success",t==="success"))},E=e=>{e.classList.remove("is-invalid");const t=H.get(e.name);t&&(t.textContent="")},V=(e,t)=>{e.classList.add("is-invalid");const r=H.get(e.name);r&&(r.textContent=t)},W=e=>{const t=s[c()];return e.validity.valueMissing?t["form.errorRequired"]:e.validity.typeMismatch&&e.type==="email"?t["form.errorEmailFormat"]:e.validity.tooShort?t["form.errorPasswordShort"]:t["form.errorInvalid"]};let d=0;const A=()=>{u.forEach((t,r)=>{t.hidden=r!==d}),S&&(S.disabled=d===0),g&&(g.hidden=d===u.length-1,g.disabled=!1);const e=i==null?void 0:i.querySelector("button[type='submit']");e&&(e.hidden=d!==u.length-1)},Y=()=>{const e=u[d];if(!e)return!0;const t=Array.from(e.querySelectorAll("input, textarea, select"));for(const r of t)if(!r.checkValidity())return!1;return!0},_=()=>{if(!Y()){l(s[c()]["form.errorStep"],"error");const e=u[d],r=Array.from(e.querySelectorAll("input, textarea, select")).filter(o=>!o.checkValidity());return r.forEach(o=>{V(o,W(o))}),r[0]&&r[0].focus(),!1}return!0},z=async()=>{var e;if(y)try{const t=await fetch(`${P}/api/v1/cities/`);if(!t.ok)throw new Error("cities");const r=await t.json();(((e=r==null?void 0:r.data)==null?void 0:e.cities)||[]).forEach(n=>{if(!(n!=null&&n.id)||!(n!=null&&n.name))return;const m=document.createElement("option");m.value=n.id,m.textContent=n.name,y.appendChild(m)})}catch{const r=document.createElement("option");r.value="",r.textContent=s[c()]["form.cityError"]||"Города недоступны",y.appendChild(r)}},Q=async e=>{var v,w,C,L,q,x,I,k,b,M,F,T,B,N,O,D;if(e.preventDefault(),!i||(l("",""),!_()))return;const t=new FormData(i),r=((v=t.get("password"))==null?void 0:v.toString())||"",o=((w=t.get("passwordConfirm"))==null?void 0:w.toString())||"";if(r!==o){l(s[c()]["form.errorPasswordMatch"],"error");const f=i.querySelector("#passwordConfirm");f&&V(f,s[c()]["form.errorPasswordMatch"]);return}const n={name:(C=t.get("name"))==null?void 0:C.toString().trim(),email:(L=t.get("email"))==null?void 0:L.toString().trim(),password:r,phone:(q=t.get("phone"))==null?void 0:q.toString().trim(),shopName:(x=t.get("shopName"))==null?void 0:x.toString().trim(),inn:(I=t.get("inn"))==null?void 0:I.toString().trim(),description:(k=t.get("description"))==null?void 0:k.toString().trim(),address:(b=t.get("address"))==null?void 0:b.toString().trim()},m=(M=t.get("cityId"))==null?void 0:M.toString().trim();m&&(n.cityId=m);const p=i.querySelector("button[type='submit']");p&&(p.disabled=!0);try{const f=await fetch(`${P}/api/v1/shop-registration/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(f.status===409){l(s[c()]["form.errorEmail"],"error");return}if(!f.ok){l(s[c()]["form.errorGeneric"],"error");return}const a=await f.json();(F=a==null?void 0:a.data)!=null&&F.token&&localStorage.setItem("userToken",a.data.token),(T=a==null?void 0:a.data)!=null&&T.user&&localStorage.setItem("userData",JSON.stringify(a.data.user)),(N=(B=a==null?void 0:a.data)==null?void 0:B.shop)!=null&&N.id&&localStorage.setItem("shopId",a.data.shop.id),(D=(O=a==null?void 0:a.data)==null?void 0:O.shop)!=null&&D.name&&localStorage.setItem("shopName",a.data.shop.name),i.reset(),l(s[c()]["form.success"],"success"),window.location.href="/office.html"}catch{l(s[c()]["form.errorGeneric"],"error")}finally{p&&(p.disabled=!1)}};i&&(i.addEventListener("submit",Q),i.addEventListener("input",()=>{l("","")}),i.addEventListener("input",e=>{const t=e.target;t instanceof HTMLInputElement&&E(t),t instanceof HTMLTextAreaElement&&E(t),t instanceof HTMLSelectElement&&E(t)}));g&&g.addEventListener("click",()=>{l("",""),_()&&(d=Math.min(d+1,u.length-1),A())});S&&S.addEventListener("click",()=>{l("",""),d=Math.max(d-1,0),A()});const J=()=>{const e=localStorage.getItem("userToken"),t=Array.from(document.querySelectorAll("[data-auth-toggle]")),r=c();t.forEach(o=>{const n=o.getAttribute("data-i18n");e?(o.href="/office.html",n==="form.login"?(o.textContent=s[r]["form.loginOffice"]||"Уже есть магазин? В кабинет",o.setAttribute("data-i18n","form.loginOffice")):(o.textContent=s[r]["cta.office"]||"В кабинет",o.setAttribute("data-i18n","cta.office"))):(o.href="/login.html",n==="form.loginOffice"?(o.textContent=s[r]["form.login"]||"Уже есть магазин? Войти",o.setAttribute("data-i18n","form.login")):(o.textContent=s[r]["cta.login"]||"Войти",o.setAttribute("data-i18n","cta.login")))})};K(c());z();A();J();
