import{t as i}from"./styles-DXc76zUi.js";const x="https://api.libiss.com/api/v1",O="libiss-pos-lang",U="ru",z=Array.from(document.querySelectorAll("[data-i18n]")),G=Array.from(document.querySelectorAll("[data-i18n-attr]")),D=Array.from(document.querySelectorAll(".lang-btn")),E=document.querySelector("[data-office-welcome]"),b=document.querySelector("[data-office-store]");document.querySelector("[data-office-store-name]");document.querySelector("[data-office-store-id]");document.querySelector("[data-office-store-plan]");document.querySelector("[data-office-store-subscribed]");const q=document.querySelector("[data-office-license]"),w=document.querySelector("[data-office-license-shop]"),L=document.querySelector("[data-office-license-shop-id]"),N=document.querySelector("[data-office-license-key]"),k=document.querySelector("[data-office-license-days]"),T=document.querySelector("[data-office-license-expires]"),l=document.querySelector("[data-trial-btn]"),I=document.querySelector("[data-trial-status]"),s=()=>{const t=localStorage.getItem(O);return t&&i[t]?t:navigator.language.toLowerCase().startsWith("ru")?"ru":"en"},$=t=>{const e=i[t]||i[U];z.forEach(n=>{const r=n.dataset.i18n;e[r]&&(n.textContent=e[r])}),G.forEach(n=>{const r=n.dataset.i18nAttr,a=n.dataset.i18nKey;r&&a&&e[a]&&n.setAttribute(r,e[a])}),document.documentElement.lang=t,D.forEach(n=>{n.classList.toggle("is-active",n.dataset.lang===t)}),localStorage.setItem(O,t)};D.forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.lang;e&&$(e)})});const P=t=>{if(!E)return;const e=i[s()]["office.welcome"]||"Регистрация завершена. Ваш кабинет готов.";E.textContent=t?`${e} ${t}`:e},v=(t,e)=>{var d,c;if(!t)return;const n=t.querySelector("[data-office-store-name]"),r=t.querySelector("[data-office-store-id]"),a=t.querySelector("[data-office-store-plan]"),o=t.querySelector("[data-office-store-subscribed]");n&&(n.textContent=(e==null?void 0:e.name)||"—"),r&&(r.textContent=(e==null?void 0:e.id)||"—"),a&&(a.textContent=((d=e==null?void 0:e.license)==null?void 0:d.subscriptionType)||((c=e==null?void 0:e.license)==null?void 0:c.subscriptionStatus)||i[s()]["office.planEmpty"]),o&&((e==null?void 0:e.isSubscribed)===!0?o.textContent=i[s()]["office.subscribedYes"]:(e==null?void 0:e.isSubscribed)===!1?o.textContent=i[s()]["office.subscribedNo"]:o.textContent=i[s()]["office.subscribedUnknown"])},W=t=>{if(!b)return;const e=Array.isArray(t)?t:[],n=b.parentElement;if(n){if(n.querySelectorAll("[data-office-store]").forEach(r=>r.remove()),e.length===0){const r=b.cloneNode(!0);v(r,{}),n.appendChild(r);return}e.forEach(r=>{const a=b.cloneNode(!0);v(a,r),n.appendChild(a)})}},R=t=>{if(!t)return"—";const e=new Date(t);return Number.isNaN(e.getTime())?"—":e.toLocaleDateString()},Y=t=>{q&&(w&&(w.textContent="—"),L&&(L.textContent="—"),N&&(N.textContent="—"),k&&(k.textContent=Number.isFinite(t==null?void 0:t.daysRemaining)?String(t.daysRemaining):"—"),T&&(T.textContent=R(t==null?void 0:t.expires_at)))},H=t=>{if(!q||!Array.isArray(t)||t.length===0){Y(null);return}const e=t.map(r=>{var o,d;const a=q.cloneNode(!0);return a.querySelector("[data-office-license-shop]").textContent=((o=r==null?void 0:r.shop)==null?void 0:o.name)||"—",a.querySelector("[data-office-license-shop-id]").textContent=((d=r==null?void 0:r.shop)==null?void 0:d.id)||(r==null?void 0:r.shopId)||"—",a.querySelector("[data-office-license-key]").textContent=(r==null?void 0:r.licenseKey)||(r==null?void 0:r.key)||"—",a.querySelector("[data-office-license-days]").textContent=Number.isFinite(r==null?void 0:r.daysRemaining)?String(r.daysRemaining):"—",a.querySelector("[data-office-license-expires]").textContent=R((r==null?void 0:r.expiresAt)||(r==null?void 0:r.expires_at)),a}),n=q.parentElement;n&&(n.querySelectorAll("[data-office-license]").forEach(r=>r.remove()),e.forEach(r=>n.appendChild(r)))},M=async t=>{var o;const e=t.dataset.copy,n=t.closest("[data-office-license]");if(!n)return;const r=e==="shopId"?n.querySelector("[data-office-license-shop-id]"):n.querySelector("[data-office-license-key]"),a=(o=r==null?void 0:r.textContent)==null?void 0:o.trim();if(!(!a||a==="—"))try{await navigator.clipboard.writeText(a),t.classList.add("is-copied"),t.setAttribute("aria-label",i[s()]["office.copied"]),setTimeout(()=>{t.classList.remove("is-copied"),t.setAttribute("aria-label",i[s()]["office.copy"])},1200)}catch{t.setAttribute("aria-label",i[s()]["office.copyFailed"]),setTimeout(()=>{t.setAttribute("aria-label",i[s()]["office.copy"])},1200)}};document.addEventListener("click",t=>{const e=t.target;e instanceof HTMLElement&&e.matches("[data-copy]")&&M(e)});const Q=t=>{l&&(l.style.display=t?"none":"inline-flex")},S=(t,e)=>{I&&(I.textContent=t,I.classList.toggle("is-error",e==="error"),I.classList.toggle("is-success",e==="success"))},V=t=>{var e,n;return Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t==null?void 0:t.licenses)?t.licenses:Array.isArray((e=t==null?void 0:t.data)==null?void 0:e.licenses)?t.data.licenses:Array.isArray((n=t==null?void 0:t.data)==null?void 0:n.items)?t.data.items:[]},F=async(t,e)=>{const n=await C(`${x}/licenses/my`,t),a=V(n).map(o=>{var c;if(o!=null&&o.shop)return o;const d=(c=e==null?void 0:e.find)==null?void 0:c.call(e,m=>(m==null?void 0:m.id)===(o==null?void 0:o.shopId));return d?{...o,shop:d}:o});H(a),Q(a.length>0)},X=async()=>{if(!l)return;const t=localStorage.getItem("userToken"),e=localStorage.getItem("shopId");if(!t||!e){S(i[s()]["office.trialErrorAuth"],"error");return}S("",""),l.disabled=!0;try{const n=await fetch(`${x}/licenses/trial`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({shopId:e})});if(!n.ok){n.status===409?S(i[s()]["office.trialExists"],"error"):S(i[s()]["office.trialError"],"error");return}const r=await n.json();r!=null&&r.data&&(localStorage.setItem("licenseData",JSON.stringify(r.data)),S(i[s()]["office.trialSuccess"],"success"),await F(t))}catch{S(i[s()]["office.trialError"],"error")}finally{l.disabled=!1}},C=async(t,e)=>{const n=await fetch(t,{headers:e?{Authorization:`Bearer ${e}`}:{}});return n.ok?n.json():null},Z=async()=>{var d;const t=localStorage.getItem("userToken"),e=localStorage.getItem("userData"),n=localStorage.getItem("shopId"),r=localStorage.getItem("shopName");let a=e?JSON.parse(e):null;if(t){const c=await C(`${x}/users/profile`,t);c&&(a=c,localStorage.setItem("userData",JSON.stringify(c)))}P(a==null?void 0:a.name);let o=[];if(t&&(a!=null&&a.id)){const c=await C(`${x}/shops/`,t),m=Array.isArray(c)&&c||((d=c==null?void 0:c.data)==null?void 0:d.shops)||(c==null?void 0:c.data)||(c==null?void 0:c.shops)||[],j=Array.isArray(m)?m:[],y=String(a.id);o=j.filter(f=>{const B=f!=null&&f.userId?String(f.userId):null,J=f!=null&&f.ownerId?String(f.ownerId):null,g=f==null?void 0:f.user,_=g!=null&&g.id?String(g.id):null,A=f==null?void 0:f.owner,K=A!=null&&A.id?String(A.id):null;return B===y||J===y||_===y||K===y});const u=o[0]||null;u!=null&&u.id&&(localStorage.setItem("shopId",u.id),u!=null&&u.name&&localStorage.setItem("shopName",u.name))}W(o.length>0?o:[{id:n,name:r}]),t&&await F(t,o)};$(s());Z();l&&l.addEventListener("click",X);
